<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta property="og:title" content="Desenvolvedor Matheus-Ribeiro95" />
    <meta property="og:description" content="Página para listagem dos meus repositórios abertos do GitHub e GitLab" />

    <meta property="og:image" content="https://matheus-ribeiro95.github.io/helloWorld/cover.jpg" />
    <meta property="og:image:width" content="1920" />
    <meta property="og:image:height" content="837" />

    <meta name="author" content="Matheus Ribeiro" />
    <meta name="date" content="2025-01-23" />
    <link rel="icon" type="image/x-icon" href="./favicon.ico" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <link rel="stylesheet" href="style.css" />
</head>
<body>
<div class="header">
    <a data-disabled="" href="https://github.com/Matheus-Ribeiro95" target="_blank"><div class="button"><i class="fab fa-github"></i> GitHub</div></a>
    <a data-disabled="" href="https://gitlab.com/Matheus-Ribeiro95" target="_blank"><div class="button"><i class="fab fa-gitlab"></i> GitLab</div></a>
    <a data-disabled="" href="https://linktr.ee/matheusribeiro95" target="_blank"><div class="button"><i class="fa-solid fa-link"></i> Linktree</div></a>
    <div class="developer">Matheus-Ribeiro95</div>
</div>
<div class="bookPage">
    <div class="container">
        <div class="repo-header">
            <div class="repo-name">
                <svg aria-hidden="true" focusable="false" class="Octicon-sc-9kayk9-0 eoNnjt" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display: inline-block; user-select: none; vertical-align: text-bottom; overflow: visible;"><path d="M0 2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25Zm1.75-.25a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25V2.75a.25.25 0 0 0-.25-.25ZM7.25 8a.749.749 0 0 1-.22.53l-2.25 2.25a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L5.44 8 3.72 6.28a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215l2.25 2.25c.141.14.22.331.22.53Zm1.5 1.5h3a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1 0-1.5Z"></path></svg>
                Matheus-Ribeiro95:&#126;&#36; ./helloWorld
            </div>
            <div class="repo-stats">
                <div class="stat-item">
                    <i class="far fa-star"></i>
                    <span>245</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-code-branch"></i>
                    <span>84</span>
                </div>
            </div>
        </div>

        <div>
            <button class="button">
                <i class="fas fa-code-branch"></i>
                main
            </button>
            <button class="button">
                <i class="far fa-clone"></i>
                Clone
            </button>
        </div>

        <div class="branch-nav">
            <div><i class="fas fa-code"></i> Code</div>
            <div><i class="fas fa-exclamation-circle"></i> Issues</div>
            <div><i class="fas fa-code-branch"></i> Pull requests</div>
        </div>

        <div class="files-section"></div>

        <div class="readme">
            <nav class="readme-nav">
                <ul class="nav-list">
                    <li
                            class="nav-item active"
                            data-id-readme="default"
                    >
                        HelloWorld <span class="close">X</span>
                    </li>
                </ul>
            </nav>

            <div id="innerDefault"></div>
            <div class="hide" id="inner"></div>
        </div>
    </div>

    <div class="spacer"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
    const _FILES = {};
    const _READMES = {};
    let _tabOpened = false;
    const _APILIMITED = {
        "GitHub": false,
        "GitLab": false,
    };

    document
        .querySelector(".readme")
        .addEventListener("click", function (event) {
            const target = event.target;

            if (
                !(
                    (target.nodeName === "LI" &&
                        target.classList.contains("nav-item")) ||
                    (target.nodeName === "SPAN" &&
                        target.classList.contains("close"))
                )
            )
                return;

            if (target.nodeName === "LI") {
                const idReadme = target.dataset.idReadme;
                selectTab(idReadme, false);
            } else {
                const idReadme = target.parentElement.dataset.idReadme;
                closeTab(idReadme);
            }
        });

    // https://gist.github.com/rfl890/e3c01d6285573f00cb333f6141c4f071
    function btoaUTF8(data) {
        const utf8Data = new TextEncoder().encode(data);
        let binaryString = "";
        for (let i = 0; i < utf8Data.length; i++) {
            binaryString += String.fromCharCode(utf8Data[i]);
        }
        return btoa(binaryString);
    }
    function atobUTF8(data) {
        const decodedData = atob(data);
        const utf8data = new Uint8Array(decodedData.length);
        const decoder = new TextDecoder("utf-8");
        for (let i = 0; i < decodedData.length; i++) {
            utf8data[i] = decodedData.charCodeAt(i);
        }
        return decoder.decode(utf8data);
    }

    function selectTab(idReadme, isNew = true) {
        setupFiles(idReadme);
        if (!_tabOpened) {
            _tabOpened = true;
            document.querySelector(".files-section").style.minHeight = "212px";
        }

        document.querySelectorAll("li.nav-item").forEach((el) => {
            if (el.dataset.idReadme != idReadme) {
                el.classList.remove("active");
            } else {
                el.classList.add("active");
            }

            const innerDefault = document.getElementById("innerDefault");
            const inner = document.getElementById("inner");

            if (idReadme === "default") {
                inner.classList.add("hide");
                innerDefault.classList.remove("hide");
            } else {
                innerDefault.classList.add("hide");
                inner.classList.remove("hide");

                inner.innerHTML = marked.parse(atobUTF8(_READMES[idReadme]));
            }

            /*
                REVIEW: Good idea?
             */
            if (isNew) document.querySelector(".readme").scrollIntoView();
            setUpCopyIcons();
            setUpAnchorElements();
        });
    }

    function closeTab(idReadme) {
        if (idReadme === "default") return;

        setupFiles("default");

        const el = document.querySelector(
            `li.nav-item[data-id-readme="${idReadme}"]`
        );
        el.parentElement.removeChild(el);

        selectTab("default", false);
    }

    function setUpNewTab({content, repoName, repoURL}) {
        const idReadme = repoURL;
        _READMES[idReadme] = content;

        const liEl = document.createElement("li");
        liEl.classList.add("nav-item");
        liEl.dataset.idReadme = repoURL;
        liEl.textContent = repoName.split("_").join(" ");

        const spanEl = document.createElement("span");
        spanEl.classList.add("close");
        spanEl.textContent = "X";

        liEl.appendChild(spanEl);

        document.querySelector("ul.nav-list").appendChild(liEl);
        selectTab(idReadme);
    }

    function filesArrayHTML(files) {
        const $filesSection = document.querySelector(".files-section");
        $filesSection.innerHTML = "";
        files.forEach(file => {
            const divEl = document.createElement("div");
            divEl.classList.add("file-item");

            const iEl = document.createElement("i");
            iEl.classList.add("far", "file-icon");

            if (file.type === "dir") iEl.classList.add("fa-folder")
            else iEl.classList.add("fa-file-code");

            const aEl = document.createElement("a");
            aEl.href = file.html_url;
            aEl.target = "_blank";
            aEl.dataset.disabled = "";
            aEl.classList.add("file-name");
            aEl.textContent = file.name;

            divEl.append(iEl, aEl);

            $filesSection.append(divEl);
        });
    }

    function setupFiles(repoURL) {
        if (_FILES[repoURL]) return filesArrayHTML(_FILES[repoURL]);

        const path =
            repoURL === "default" && "helloWorld" ||
            repoURL.split("/")[4];

        fetch(`https://api.github.com/repos/Matheus-Ribeiro95/${path}/contents`)
            .then(response => {
                if ((response.status === 403 || response.status === 429) && !_APILIMITED["GitHub"]) {
                    _APILIMITED["GitHub"] = true;
                    alert("GitHub API rate limite alcançado.");

                    throw new Error("GitHub API limit rate.");
                }

                return response.json();
            })
            .then(data => {
                const files = data.sort((a, b) => a.type > b.type || a.name.toLowerCase() > b.name.toLowerCase());

                _FILES[repoURL] = files;

                filesArrayHTML(files);
            })
            .catch(error => console.log(error));
    }

    function setupFilesGitLab(projectID, repoName) {
        if (_FILES[projectID]) return filesArrayHTML(_FILES[projectID]);

        fetch(`https://gitlab.com/api/v4/projects/${projectID.split("/")[4]}/repository/tree`)
            .then(response => response.json())
            .then(data => {
                let files = data.sort((a, b) => b.type.localeCompare(a.type) || a.name.toLowerCase() > b.name.toLowerCase()).map(({ type, name }) => ({
                    type: type === "tree" && "dir" || "file",
                    name,
                    html_url: `https://gitlab.com/Matheus-Ribeiro95/${encodeURI(repoName.toLowerCase().split("_").join("-"))}/-/blob/master/${name}?ref_type=heads`
                }));

                _FILES[projectID] = files;

                filesArrayHTML(files);
            });
    }

    function getRepoREADME(repoURL, repoName) {
        setupFiles(repoURL);

        if (_READMES[repoURL]) {
            const tabExists =
                document.querySelector(
                    `li.nav-item[data-id-readme="${repoURL}"]`
                ) !== null;

            if (tabExists) selectTab(repoURL);
            else
                setUpNewTab({
                    content: _READMES[repoURL],
                    repoName,
                    repoURL,
                });

            return;
        }

        fetch(
            `https://api.github.com/repos/Matheus-Ribeiro95/${repoURL.split("/")[4]}/readme`,
            {
                headers: {
                    "Accept": "application/vnd.github+json",
                    "X-GitHub-Api-Version": "2022-11-28",
                },
            }
        )
            .then((response) => {
                if ((response.status === 403 || response.status === 429) && !_APILIMITED["GitHub"]) {
                    _APILIMITED["GitHub"] = true;
                    alert("GitHub API rate limite alcançado.");

                    throw new Error("GitHub API limit rate.");
                }

                return response.json();
            })
            .then((response) => {
                const { content } = response;
                setUpNewTab({
                    content,
                    repoName,
                    repoURL,
                });
            })
            .catch(error => console.log(error));
    }

    function getRepoGitLabREADME(projectID, repoName) {
        setupFilesGitLab(projectID, repoName);

        if (_READMES[projectID]) {
            const tabExists =
                document.querySelector(
                    `li.nav-item[data-id-readme="${projectID}"]`
                ) !== null;

            if (tabExists) selectTab(projectID);
            else
                setUpNewTab({
                    content: _READMES[projectID],
                    repoName,
                    repoURL: projectID,
                });

            return;
        }

        fetch(`https://gitlab.com/api/v4/projects/${projectID.split("/")[4]}/repository/files/README.md?ref=master`)
            .then(response => response.json())
            .then(data => {
                const { content } = data;
                setUpNewTab({
                    content,
                    repoName,
                    repoURL: projectID,
                });
            });
    }

    function setUpCopyIcons() {
        document.querySelectorAll("i.copy").forEach((el) => {
            if (el.classList.contains("listener")) return;

            el.addEventListener("click", function () {
                const preEl = this.parentElement.parentElement.querySelector("pre code");

                let text = preEl.innerText.trim();

                if (text.indexOf("---")) {
                    text = text.split("---")[0].trim();
                }

                navigator.clipboard.writeText(text);
            });

            el.classList.add("listener");
        });
    }

    function setUpAnchorElements() {
        document.querySelectorAll(".readme a").forEach((el) => {
            el.onclick = function (event) {
                const isDynamic = el.classList.contains("dynamic");

                if (!isDynamic) return;

                const elTrigger = event.target;

                if (elTrigger.nodeName === "SPAN") {
                    event.preventDefault();

                    el.classList.add("clicked-anchor");

                    const isGitHubRepo = el.href .indexOf("github") !== -1;

                    if (isGitHubRepo) getRepoREADME(el.href, el.dataset.nameReadme);
                    else getRepoGitLabREADME(el.href, el.dataset.nameReadme)
                } else {
                    el.classList.add("clicked-icon");
                }
            };
        });
    }

    const renderer = {
        link: function ({text, href}) {
            const isLocal = href.indexOf("#") !== -1;
            const isDynamic = href.indexOf("*") === 0;

            const anchorEl = document.createElement("a");

            if (isDynamic) {
                anchorEl.classList.add("dynamic");

                const spanEl = document.createElement("span");
                spanEl.innerText = text;
                anchorEl.appendChild(spanEl);

                const data = href.substring(1).split("|");
                anchorEl.href = data[0];
                anchorEl.dataset.nameReadme = data[1];

                const iEl = document.createElement("i");
                iEl.classList.add(
                    "fa-solid",
                    "fa-arrow-up-right-from-square"
                );
                anchorEl.appendChild(iEl);
            } else {
                anchorEl.innerText = text;
                anchorEl.href = href;
            }

            if (!isLocal) {
                anchorEl.target = "_blank";
            }

            return anchorEl.outerHTML;
        },
        heading: function ({tokens, depth}) {
            const text = this.parser.parseInline(tokens);

            const hash = text.toLowerCase().split(" ").join("-");

            return `<h${depth} id="${hash}">${text}</h${depth}>`;
        },
        code: function ({codeBlockStyle, raw, text, type}) {
            return `<div class="code"><pre><code>${text}</code></pre> <div><i class="copy fa-regular fa-copy"></i></div></div>`;
        },
    };

    marked.use({renderer});

    fetch("./README.md")
        .then((response) => response.text())
        .then((markdown) => {
            _READMES["default"] = btoaUTF8(markdown);

            document.getElementById("innerDefault").innerHTML = marked.parse(markdown);

            setupFiles("default");

            setUpCopyIcons();
            setUpAnchorElements();
        });
</script>
<script></script>
</body>
</html>
